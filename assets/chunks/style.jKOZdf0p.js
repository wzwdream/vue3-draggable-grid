import{h as y,a4 as O,g as k,d as Q,a5 as U,m as D,y as ve,j as Z,z as ge,$ as fe,o as j,c as ee,a6 as M,a7 as X,k as B,r as A,_ as te,N as pe,a2 as F,n as V,p as he,q as me}from"./framework.Sl4RQmCU.js";const ae=Symbol(),we=(e,t,a)=>(a-(e-1)*t)/e,q=(e,t,a)=>{let n=0,r=0;for(const{y:o,h:i}of a)o+i>n+r&&(n=o,r=i);return(n+r-2)*t+(n+r-1)*e+e+t},K=(e,t,a=0)=>e<=0?1:a&&e+t>=a+1?a+1-t:e,R=(e,t)=>{const a=e.findIndex(r=>r.id===t),n=e[a];return{index:a,data:n}},ye=(e,t,a,n,r,o)=>{if(!e)return;const i=e.getContext("2d");if(i){i.clearRect(0,0,e.width,e.height),e.width=a-10,e.height=t,i.fillStyle="#000",i.lineWidth=.2,i.setLineDash([20,5]);for(let s=r+Number(o)/2;s<t;s=s+r+Number(o))i.beginPath(),i.moveTo(0,s),i.lineTo(a,s),i.stroke();for(let s=n+Number(o)/2;s<a;s=s+n+Number(o))i.beginPath(),i.moveTo(s,0),i.lineTo(s,t),i.stroke()}},W=(e,t=new WeakMap)=>{if(e===null||typeof e!="object")return e;if(e instanceof Date)return new Date(e.getTime());if(e instanceof RegExp)return new RegExp(e.source);if(t.has(e))return t.get(e);const a=Array.isArray(e)?[]:Object.create(null);t.set(e,a);for(const n in e)a[n]=W(e[n],t);return a},ne=({x:e,y:t,w:a,h:n},{x:r,y:o,w:i,h:s})=>e+a>r&&e<r+i&&t+n>o&&t<o+s,xe=e=>e.filter(t=>!!t.static),Y=(e,t)=>e.filter(a=>a.id!==t.id).some(a=>ne(t,a)),re=(e,t,a)=>{const{index:n,data:r}=R(e,t),{w:o,static:i}=r;if(i)return e;let s=r.x,l=r.y,f="left",I="";const H=()=>Y(e,{...r,x:s,y:l});for(;H();)if(f==="left"&&(s>1?s--:f="right"),f==="right"&&(s+o<=a?s++:(I===""&&(I="up"),f="left")),I==="up"&&(l>1?(l--,I=""):I="down"),I==="down"){if(s+o<=a)continue;l++,f="left"}const N={...r,x:s,y:l};return[...e.slice(0,n),N,...e.slice(n+1)]},be=(e,t)=>e.filter(a=>a.id!==t.id&&ne(t,a)).map(a=>a.id),se=(e,t,a)=>{let n=W(e),r=t.x,o=t.y;const i=xe(e);if(Y(i,t)){const{x:l,y:f}=ie(i,t,a);r=l,o=f}t={...t,x:r,y:o};const{index:s}=R(n,t.id);if(n[s]=t,Y(n,t)){const l=be(n,t);for(const f of l)n=re(n,f,a)}return{data:n,x:r,y:o}},oe=(e,t)=>{let a=W(e);for(let n=0;n<a.length;n++){const r=a[n];r.static||(r.x<0&&(r.x=1),r.x+r.w>t+1&&(r.x=1),r.w>t&&(r.w=t)),a=se(a,r,t).data}return a},ie=(e,t,a)=>{const n=[...e,{...t}],r=re(n,t.id,a),{data:o}=R(r,t.id);return{data:r,x:o.x,y:o.y}},Se=e=>{const t=y(Number(e.col)),a=y(Number(e.rowH)),n=y(Number(e.gutter)),r=y(e.isCollision||!0),o=y(W(oe(e.data,t.value))),i=y(!1),s=y("");let l=O({x:0,y:0,h:0,w:0});const f=k(()=>{const{index:m,data:g}=R(o.value,s.value);return{index:m,data:g}}),I=m=>{s.value=m;const{x:g,y:w,h:v,w:u}=f.value.data;l.x=g,l.y=w,l.h=v,l.w=u,i.value=!0},H=(m,g,w,v)=>{const{x:u,y:_,h:S,w:L}=f.value.data,c=Math.round(m/(w+n.value)),d=Math.round(g/(a.value+n.value));if(v==="drag"){const x=u+c,z=_+d;l.x=K(x,L,t.value),l.y=K(z,S)}v==="resize"&&(l.w=L+c<=0?1:u+c>t.value?t.value-u+L:L+c,l.h=S+d<=0?1:S+d);let p={...l,id:s.value};const{data:b,x:E,y:$}=r.value?se(o.value,p,t.value):ie(o.value.filter(x=>x.id!==s.value),p,t.value);return p={...p,x:E,y:$},l.x=E,l.y=$,b.forEach(x=>{if(x.id!==s.value){const{index:z}=R(o.value,x.id);o.value.splice(z,1,x)}}),{newData:b,newItem:p}},N=()=>{const{x:m,y:g,h:w,w:v}=l,{index:u,data:_}=f.value,S={..._,x:m,y:g,h:w,w:v};o.value.splice(u,1,S),i.value=!1},h=m=>{s.value=m;const{index:g}=f.value;o.value.splice(g,1)},G=k(()=>({xStart:l.x,yStart:l.y,xEnd:l.x+l.w,yEnd:l.y+l.h}));return{layoutdata:o,col:t,rowH:a,gutter:n,draggableStart:I,draggableHandle:H,draggableEnd:N,drageItem:l,isDraging:i,dragingstyle:G,removes:h,propsId:s,dragingData:f,isCollision:r}},Ee=()=>{const e=y(0),t=y(0),a=k(()=>`${t.value}px`),n=O({gridTemplateColumns:"repeat(0, minmax(50px, 1fr))",gridAutoRows:"0px",gap:"0px",height:a});return{colWidth:e,layoutHeight:t,layoutStyle:n,updateStyle:(o,i,s)=>{n.gridTemplateColumns=`repeat(${o}, ${e.value}px)`,n.gridAutoRows=`${i}px`,n.gap=`${s}px`}}},Ie={class:"grid"},_e={class:"dragingItem"},Le=Q({__name:"GridLayout",props:{data:{default:()=>[]},width:{},height:{},col:{default:12},rowH:{default:50},gutter:{default:10},drage:{type:Boolean,default:!0},resize:{type:Boolean,default:!0},remove:{type:Boolean,default:!0},isDrawGridLines:{type:Boolean,default:!0},isCollision:{type:Boolean,default:!0}},emits:["update:data","draggableStart","draggableHandle","draggableEnd","remove"],setup(e,{emit:t}){U(C=>({ef0acd2e:D(L).gridTemplateColumns,"7f6110fc":D(L).gridAutoRows,ca97fb3c:D(L).gap,"08663bca":D(L).height,c3ec1172:D(m).yStart,c755c2b0:D(m).xStart,"370a3100":D(m).yEnd,"3709bca1":D(m).xEnd}));const a=e,n=y(),r=k(()=>a.drage),o=k(()=>a.resize),i=k(()=>a.remove),s=k(()=>a.isDrawGridLines),{draggableStart:l,draggableHandle:f,draggableEnd:I,isDraging:H,isCollision:N,removes:h,propsId:G,dragingstyle:m,layoutdata:g,col:w,rowH:v,gutter:u}=Se(a),{layoutHeight:_,colWidth:S,layoutStyle:L,updateStyle:c}=Ee(),d=y(null),p=()=>{d.value&&(S.value=we(w.value,u.value,d.value.clientWidth))},b=()=>{n.value&&d.value&&a.isDrawGridLines&&ye(n.value,_.value,d.value.clientWidth,S.value,v.value,u.value)},E=()=>{d.value&&(_.value=q(v.value,u.value,g.value))};ve([w,v,u,g],()=>{p(),H.value||E(),b()}),Z(()=>{p(),E(),b(),window.onresize=()=>{p(),b()}}),ge(()=>{g.value=W(oe(a.data,Number(a.col))),JSON.stringify(g.value)!==JSON.stringify(a.data)&&x(),v.value=Number(a.rowH),w.value=Number(a.col),u.value=Number(a.gutter),N.value=a.isCollision,c(w.value,v.value,u.value)});const $=t,x=()=>{$("update:data",g.value)};return fe(ae,{layoutdata:g,rowH:v,col:w,gutter:u,colWidth:S,drage:r,resize:o,remove:i,draggableStart:C=>{l(C),$("draggableStart",C)},draggableHandle:(C,J,de)=>{const{newData:ue,newItem:ce}=f(C,J,S.value,de);_.value=q(v.value,u.value,ue),$("draggableHandle",G.value,ce)},draggableEnd:()=>{I(),x(),$("draggableEnd",g.value)},removes:C=>{h(C),x(),$("remove",C)}}),(C,J)=>(j(),ee("div",Ie,[M(B("canvas",{ref_key:"canvas",ref:n,class:"canvas"},null,512),[[X,s.value]]),B("div",{class:"grid-layout",ref_key:"gridLayoutRef",ref:d},[A(C.$slots,"default",{},void 0,!0),M(B("div",_e,null,512),[[X,D(H)]])],512)]))}}),Be=te(Le,[["__scopeId","data-v-c433fd08"]]),le=e=>(he("data-v-62964a29"),e=e(),me(),e),$e=le(()=>B("div",{class:"grid-item-resize"},null,-1)),De=["onPointerdown"],Ce=le(()=>B("div",{class:"grid-item-remove"},"X",-1)),He=Q({__name:"GridItem",props:{id:{default:""},draggableFrom:{default:""}},setup(e){U(c=>({a25d6a92:h.value.yStart,a5c71bd0:h.value.xStart,"6920bf20":h.value.yEnd,"6921a7de":h.value.xEnd,bb0f0e90:h.value.width,da70b716:h.value.height,"0491cd34":u.width,c145ccf2:u.height,"1bcef1e8":u.transform}));const t=e,{layoutdata:a,rowH:n,gutter:r,colWidth:o,drage:i,resize:s,remove:l,draggableStart:f,draggableHandle:I,draggableEnd:H,removes:N}=pe(ae),h=k(()=>{const{data:c}=R(a.value,t.id),{x:d,y:p,w:b,h:E,static:$}=c,x=d+b,z=p+E,T=`${(b-1)*r.value+b*o.value}px`,P=`${(E-1)*r.value+E*n.value}px`;return{xStart:d,yStart:p,xEnd:x,yEnd:z,width:T,height:P,data:c,static:!!$}}),G=y(null),m=y(0),g=y(0),w=y(!1),v=y();Z(()=>{var c;if(!(h.value.static||!i.value))if((t.draggableFrom??"")==="")(c=G.value)==null||c.addEventListener("pointerdown",d=>{_(d,"drag")});else{const d=document.getElementById(t.draggableFrom);d&&(d.style.cursor="move",d.addEventListener("pointerdown",p=>{_(p,"drag")}))}});const u=O({width:"0px",height:"0px",transform:"translate3d(0, 0, 0)"}),_=(c,d)=>{h.value.data.static||!i||!d||(v.value=d,m.value=c.clientX,g.value=c.clientY,window.addEventListener("pointermove",S),window.addEventListener("pointerup",L),w.value=!0,f(t.id))},S=c=>{const{clientX:d,clientY:p}=c,b=d-m.value,E=p-g.value;if(v.value==="drag"&&(u.transform=`translate3d(${b}px, ${E}px, 0)`),v.value==="resize"&&a){const{width:$,height:x}=h.value,z=Math.max(parseInt($)+b,o.value),T=Math.max(parseInt(x)+E,n.value);u.width=`${z}px`,u.height=`${T}px`}I(b,E,v.value)},L=()=>{if(v.value==="drag"&&(u.transform="translate3d(0, 0, 0)"),v.value==="resize"&&a){const{width:c,height:d}=h.value;u.width=`${parseInt(c)}px`,u.height=`${parseInt(d)}px`}window.removeEventListener("pointermove",S),window.removeEventListener("pointerup",L),H(),w.value=!1};return(c,d)=>(j(),ee("div",{class:V(["grid-item-box",{"grid-draging":w.value&&v.value==="drag"}]),ref_key:"gridItemRef",ref:G},[B("div",{class:V({"grid-item":!0,"static-item":h.value.static||t.draggableFrom,"grid-resizing":w.value&&v.value==="resize"})},[A(c.$slots,"default",{},void 0,!0),M(B("div",{onPointerdown:d[0]||(d[0]=F(p=>_(p,"resize"),["stop"]))},[A(c.$slots,"resize",{},()=>[$e],!0)],544),[[X,D(s)&&!h.value.static]]),M(B("div",{onPointerdown:F(_,["stop"]),onClick:d[1]||(d[1]=F(p=>D(N)(t.id),["stop"]))},[A(c.$slots,"remove",{},()=>[Ce],!0)],40,De),[[X,D(l)&&!h.value.static]])],2)],2))}}),Ne=te(He,[["__scopeId","data-v-62964a29"]]);export{Ne as G,Be as a};
